<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chip & Atlas Jo TV â€” Kids & Family</title>
<meta name="color-scheme" content="light">
<style>
  :root{--green:#1fa37d; --orange:#ff7a1a; --pink:#ff64b0; --blue:#3aa7ff; --yellow:#ffdf5e; --bg:#f7fbff; --ink:#223;}
  *{box-sizing:border-box}
  body{margin:0; font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Color Emoji"; color:var(--ink); background:var(--bg);}
  header{display:flex; align-items:center; gap:1rem; padding:1rem 1.25rem; position:sticky; top:0; z-index:5; background:#fff8; backdrop-filter:blur(6px); border-bottom:1px solid #0001}
  .logo{display:inline-flex; align-items:center; gap:.75rem}
  .badge{display:inline-grid; place-items:center; width:48px; height:48px; border-radius:14px; background:conic-gradient(from 180deg, var(--green), var(--blue), var(--pink), var(--orange)); color:#fff; font-weight:800}
  .title{font-weight:900; font-size:1.25rem;}
  .controls{margin-left:auto; display:flex; flex-wrap:wrap; gap:.5rem}
  .controls > *{border:1px solid #0002; background:#fff; padding:.5rem .6rem; border-radius:10px; font:inherit}
  .btn{cursor:pointer; font-weight:700}
  .btn.primary{background:var(--green); color:#fff; border-color:transparent}
  main{display:grid; grid-template-columns: 340px 1fr; gap:1rem; padding:1rem; min-height:calc(100vh - 68px)}
  @media (max-width: 960px){ main{grid-template-columns:1fr} }
  .panel{background:#fff; border:1px solid #0001; border-radius:14px; box-shadow:0 8px 20px #0001}
  .filters{display:grid; gap:.5rem; grid-template-columns:1fr 1fr; padding:1rem; border-bottom:1px dashed #0001}
  .filters input{grid-column:1/-1}
  .guide{max-height:70vh; overflow:auto}
  .row{display:grid; grid-template-columns:56px 1fr 72px; align-items:center; gap:.75rem; padding:.6rem 1rem; border-bottom:1px solid #00006; cursor:pointer}
  .row:nth-child(odd){background:#f9fbff}
  .row:hover{background:#eef7ff}
  .ch-num{font-weight:800; color:#334; text-align:center}
  .ch-name{font-weight:700}
  .tag{font-size:.75rem; background:#eef7ff; color:#135; padding:.22rem .5rem; border-radius:100px; display:inline-block}
  .player{display:grid; grid-template-rows:auto 1fr}
  .viewport{background:#000; aspect-ratio:16/9; width:100%; border-top-left-radius:14px; border-top-right-radius:14px}
  video{width:100%; height:100%; background:#000}
</style>
</head>
<body>
<header>
  <div class="logo">
    <div class="badge">C&A</div>
    <div>
      <div class="title">Chip & Atlas Jo TV</div>
      <div class="subtitle">Kids â€¢ Toddlers â€¢ Family â€” Free, Legal Live Channels</div>
    </div>
  </div>
  <div class="controls">
    <button class="btn primary" id="scanBtn">Scan & Hide Broken</button>
    <button class="btn" id="exportBtn">Export M3U</button>
  </div>
</header>

<main>
  <section class="panel">
    <div class="filters">
      <input id="search" type="text" placeholder="ðŸ”Ž Search channels"/>
      <select id="country"></select>
      <select id="language"></select>
      <label><input type="checkbox" id="workingOnly"> Show only tested-working</label>
    </div>
    <div class="guide" id="guide"></div>
  </section>
  <section class="panel player">
    <div class="viewport">
      <video id="video" controls playsinline></video>
    </div>
    <div style="padding:1rem">
      <span id="nowTitle">Pick a channel ðŸŽˆ</span>
    </div>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
<script>
const PLAYLISTS = [
  { url:'https://iptv-org.github.io/iptv/categories/kids.m3u', label:'Kids'},
  { url:'https://iptv-org.github.io/iptv/categories/education.m3u', label:'Education'}
  // you can add cartoon/series playlists here if you want adult/teen shows too
];

let ALL=[],FILTERED=[],TESTED=new Map();let CURRENT=null;

function parseM3U(text,label){
  const lines=text.split(/\r?\n/);let out=[],meta=null;
  for(const line of lines){
    if(line.startsWith('#EXTINF')){
      const name=line.split(',').pop().trim();
      meta={name,group:label};
    }else if(line && !line.startsWith('#')){
      if(meta){out.push({name:meta.name,url:line.trim(),group:meta.group});meta=null;}
    }
  }return out;
}

async function loadPlaylists(){
  const chunks=await Promise.all(PLAYLISTS.map(p=>fetch(p.url).then(r=>r.text()).then(t=>parseM3U(t,p.label)).catch(()=>[])));
  ALL=chunks.flat();applyFilters();
}

function applyFilters(){
  const q=document.getElementById('search').value.toLowerCase();
  FILTERED=ALL.filter(c=>!q||c.name.toLowerCase().includes(q));
  renderGuide();
}

function renderGuide(){
  const el=document.getElementById('guide');el.innerHTML='';
  FILTERED.forEach((c,i)=>{
    const row=document.createElement('div');row.className='row';
    row.innerHTML=`<div class="ch-num">${i+1}</div><div><div class="ch-name">${c.name}</div><div class="tag">${c.group}</div></div>`;
    row.onclick=()=>playChannel(c);el.appendChild(row);
  });
}

let hls=null;
function playChannel(ch){
  CURRENT=ch;document.getElementById('nowTitle').textContent=ch.name;
  const v=document.getElementById('video');
  if(hls){hls.destroy();hls=null;}
  if(v.canPlayType('application/vnd.apple.mpegurl')){v.src=ch.url;v.play().catch(()=>{});}
  else{hls=new Hls();hls.loadSource(ch.url);hls.attachMedia(v);hls.on(Hls.Events.MANIFEST_PARSED,()=>v.play().catch(()=>{}));}
}

document.getElementById('search').addEventListener('input',applyFilters);
loadPlaylists();
</script>
</body>
</html>
